{"version":3,"file":"useImage-71d25270.js","sources":["../jsSrc/imagePromiseFactory.js","../jsSrc/useImage.js"],"sourcesContent":["// returns a Promisized version of Image() api\nexport default ({ decode = true, crossOrigin = '', referrerPolicy }) => (src) => {\n    return new Promise((resolve, reject) => {\n        const i = new Image();\n        if (referrerPolicy)\n            i.referrerPolicy = referrerPolicy;\n        if (crossOrigin)\n            i.crossOrigin = crossOrigin;\n        i.onload = () => {\n            decode && i.decode ? i.decode().then(resolve).catch(reject) : resolve();\n        };\n        i.onerror = reject;\n        i.src = src;\n    });\n};\n//# sourceMappingURL=imagePromiseFactory.js.map","import { useState } from 'react';\nimport imagePromiseFactory from './imagePromiseFactory';\nconst removeBlankArrayElements = (a) => a.filter((x) => x);\nconst stringToArray = (x) => (Array.isArray(x) ? x : [x]);\nconst cache = {};\n// sequential map.find for promises\nconst promiseFind = (arr, promiseFactory) => {\n    let done = false;\n    return new Promise((resolve, reject) => {\n        const queueNext = (src) => {\n            return promiseFactory(src).then(() => {\n                done = true;\n                resolve(src);\n            });\n        };\n        arr\n            .reduce((p, src) => {\n            // ensure we aren't done before enquing the next source\n            return p.catch(() => {\n                if (!done)\n                    return queueNext(src);\n            });\n        }, queueNext(arr.shift()))\n            .catch(reject);\n    });\n};\nexport default function useImage({ srcList, imgPromise = imagePromiseFactory({\n    decode: true,\n    referrerPolicy: 'origin',\n}), useSuspense = true, }) {\n    const [, setIsLoading] = useState(true);\n    const sourceList = removeBlankArrayElements(stringToArray(srcList));\n    const sourceKey = sourceList.join('');\n    if (!cache[sourceKey]) {\n        // create promise to loop through sources and try to load one\n        cache[sourceKey] = {\n            promise: promiseFind(sourceList, imgPromise),\n            cache: 'pending',\n            error: null,\n        };\n    }\n    // when promise resolves/reject, update cache & state\n    cache[sourceKey].promise\n        // if a source was found, update cache\n        // when not using suspense, update state to force a rerender\n        .then((src) => {\n        cache[sourceKey] = { ...cache[sourceKey], cache: 'resolved', src };\n        if (!useSuspense)\n            setIsLoading(false);\n    })\n        // if no source was found, or if another error occured, update cache\n        // when not using suspense, update state to force a rerender\n        .catch((error) => {\n        cache[sourceKey] = { ...cache[sourceKey], cache: 'rejected', error };\n        if (!useSuspense)\n            setIsLoading(false);\n    });\n    if (cache[sourceKey].cache === 'resolved') {\n        return { src: cache[sourceKey].src, isLoading: false, error: null };\n    }\n    if (cache[sourceKey].cache === 'rejected') {\n        if (useSuspense)\n            throw cache[sourceKey].error;\n        return { isLoading: false, error: cache[sourceKey].error, src: undefined };\n    }\n    // cache[sourceKey].cache === 'pending')\n    if (useSuspense)\n        throw cache[sourceKey].promise;\n    return { isLoading: true, src: undefined, error: null };\n}\n//# sourceMappingURL=useImage.js.map"],"names":["useState"],"mappings":"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"}